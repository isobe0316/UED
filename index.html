<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸ‹ã¾ã‚‰ãªã„äºˆå®Ÿå·®ã®é—‡ - Chapter 0</title>
<style>
    :root {
        --bg-color: #050505;
        --text-main: #d0d0d0;
        --accent-blue: #6264a7;
        --accent-red: #8a0000;
        --accent-ghost: #00ffff;
    }
    body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: "Yu Mincho", "Hiragino Mincho ProN", serif;
        line-height: 2.4;
        letter-spacing: 0.05em;
        margin: 0;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* === ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€  === */
    #layer-group {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        z-index: -1; pointer-events: none;
    }
    #bg-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-size: cover; background-position: center;
        transition: opacity 1s ease; opacity: 0.5;
    }
    #cg-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
    }
    #cg-image {
        max-height: 90%; max-width: 90%;
        opacity: 0; transition: opacity 0.5s ease;
        filter: drop-shadow(0 0 20px rgba(0,0,0,0.8));
    }

    /* === ã‚²ãƒ¼ãƒ UI === */
    #game-wrapper {
        width: 100%;
        max-width: 840px;
        background-color: rgba(8, 8, 8, 0.9);
        box-shadow: 0 0 100px rgba(0,0,0,0.8);
        display: flex;
        flex-direction: column;
        border-left: 1px solid #1a1a1a;
        border-right: 1px solid #1a1a1a;
        position: relative;
    }
    
    #scene-header {
        height: 200px;
        background-size: cover;
        background-position: center;
        display: flex; align-items: center; justify-content: center;
        position: relative; overflow: hidden;
        border-bottom: 1px solid #1a1a1a;
        transition: background-image 0.5s ease;
    }
    #scene-header::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(180deg, rgba(10,10,10,0.6) 0%, rgba(0,0,0,0.85) 100%);
        z-index: 1;
    }
    /* æŠ½è±¡çš„ã‚·ãƒ³ãƒœãƒ« */
    #scene-symbol {
        width: 40px; height: 40px;
        border: 1px solid rgba(138,0,0,0.3);
        border-radius: 50%;
        position: relative;
        opacity: 0.4;
        z-index: 2;
    }
    #scene-symbol::before {
        content: ''; position: absolute;
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 20px; height: 20px;
        border: 1px solid rgba(138,0,0,0.5);
        border-radius: 50%;
    }
    #scene-symbol::after {
        content: ''; position: absolute;
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 5px; height: 5px;
        background: rgba(138,0,0,0.4);
        border-radius: 50%;
    }
    
    #teams-notification {
        position: absolute; bottom: 20px; right: 20px; width: 340px;
        background: #202020; color: #fff;
        border-left: 4px solid var(--accent-blue);
        padding: 20px; font-family: "Segoe UI", sans-serif; font-size: 0.95rem;
        box-shadow: 0 10px 40px #000;
        opacity: 0; transform: translateY(30px);
        transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        z-index: 10; pointer-events: none;
    }
    #teams-notification.active { opacity: 1; transform: translateY(0); }
    .notif-header { font-weight: bold; font-size: 0.8rem; color: #a6a8e0; display: flex; justify-content: space-between; margin-bottom: 5px; }
    
    #narrative-area {
        padding: 60px 50px;
        flex-grow: 1;
        font-size: 1.15rem;
        text-align: justify;
    }
    p { margin-bottom: 2.5em; opacity: 0; animation: fadeIn 1s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    
    .highlight { color: var(--accent-red); font-weight: bold; }
    .ghost-voice { 
        color: var(--accent-ghost); font-family: monospace; 
        text-shadow: 0 0 8px rgba(0,255,255,0.2); 
        border-left: 2px solid var(--accent-ghost); padding-left: 15px; margin: 2em 0;
    }
    .glitch-text { animation: glitch 0.3s infinite; display: inline-block; }
    @keyframes glitch { 0% {transform: translate(0)} 20% {transform: translate(-1px, 1px)} 40% {transform: translate(1px, -1px)} 100% {transform: translate(0)} }
    
    #choices-container {
        padding: 40px 60px 80px;
        display: flex; flex-direction: column; gap: 20px;
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(8,8,8,0.9) 100%);
        border-top: 1px solid #1a1a1a;
    }
    button {
        background: rgba(17,17,17,0.9); color: #999; border: 1px solid #333;
        padding: 25px 30px; text-align: left; 
        font-family: "Yu Mincho", serif; font-size: 1.05rem;
        cursor: pointer; transition: all 0.3s; position: relative;
    }
    button:hover { background: #1a1a1a; color: #fff; border-color: #666; padding-left: 40px; }
    .btn-route { border-left-width: 4px; font-weight: bold; }
    .route-logic { border-color: #4a90e2; }
    .route-emotion { border-color: #f5a623; }
    .route-fear { border-color: #9013fe; }
    .route-revenge { border-color: #d0021b; }

    /* éš ã—ãƒ«ãƒ¼ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    #secret-link {
        position: absolute; top: 10px; right: 10px;
        color: #111; font-size: 0.8rem; cursor: pointer;
        z-index: 100;
    }
    #secret-link:hover { color: #300; }
    
    .corrupted-body { background-color: #100; }
    .corrupted-btn { border-color: #f00 !important; color: #f00 !important; animation: glitch 0.5s infinite; }

    /* èµ·å‹•ç”»é¢ */
    #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9999;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        color: #fff;
    }
    #start-screen-inner {
        width: 100%; max-width: 700px;
        padding: 40px;
        display: flex; flex-direction: column;
        align-items: center;
    }
    /* ã‚²ãƒ¼ã‚¸ãƒãƒ¼ */
    #gauge-container {
        width: 100%; margin-bottom: 60px;
    }
    #gauge-label {
        color: #c0392b; font-size: 0.9rem; letter-spacing: 0.15em;
        margin-bottom: 10px; font-weight: bold;
    }
    #gauge-bar {
        width: 100%; height: 8px;
        background: #222; border-radius: 4px; overflow: hidden;
    }
    #gauge-fill {
        width: 0%; height: 100%;
        background: linear-gradient(90deg, #c0392b 0%, #e74c3c 50%, #f39c12 100%);
        border-radius: 4px;
        transition: width 2s ease-out;
    }
    /* è­¦å‘Šæ–‡ */
    #warning-text {
        color: #555; font-size: 0.85rem; letter-spacing: 0.3em;
        margin-bottom: 80px; text-align: center;
    }
    /* èª¬æ˜æ–‡ */
    #audio-notice {
        color: #888; font-size: 1rem; text-align: center;
        line-height: 2; margin-bottom: 120px;
    }
    /* èµ·å‹•ãƒœã‚¿ãƒ³ */
    #start-button {
        width: 100%; max-width: 500px;
        background: transparent; border: 1px solid #333;
        color: #ccc; padding: 20px 40px;
        font-family: "Yu Mincho", serif; font-size: 1.1rem;
        cursor: pointer; transition: all 0.3s;
        letter-spacing: 0.1em;
    }
    #start-button:hover {
        background: #111; border-color: #666; color: #fff;
    }
    @keyframes blink { 50% { opacity: 0.5; } }

    /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
    #title-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000; z-index: 9998;
        display: none; flex-direction: column;
        justify-content: center; align-items: center;
        color: #fff; cursor: pointer;
    }
    #title-screen-bg {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-image: url('images/bg_title_main.jpg');
        background-size: cover; background-position: center;
        opacity: 0.5;
    }
    #title-content {
        z-index: 1; text-align: center; text-shadow: 0 0 30px #000;
    }
    #title-main {
        font-size: 2.8rem; font-weight: bold; letter-spacing: 0.15em;
        margin-bottom: 15px; color: #fff;
    }
    #title-sub {
        font-size: 1rem; color: #888; letter-spacing: 0.2em; margin-bottom: 80px;
    }
    #title-click {
        font-size: 1rem; color: #666; animation: blink 2s infinite;
        letter-spacing: 0.1em;
    }

</style>
</head>
<body>

<div id="layer-group">
    <div id="bg-layer"></div>
    <div id="cg-layer"><img id="cg-image" src="" alt=""></div>
</div>

<div id="start-screen">
    <div id="start-screen-inner">
        <div id="gauge-container">
            <div id="gauge-label">äºˆ å®Ÿ å·® (VARIANCE)</div>
            <div id="gauge-bar"><div id="gauge-fill"></div></div>
        </div>
        <div id="warning-text">WARNING: PSYCHOLOGICAL HORROR</div>
        <div id="audio-notice">
            ã“ã®ã‚²ãƒ¼ãƒ ã¯éŸ³å£°ã‚’å†ç”Ÿã—ã¾ã™ã€‚<br>
            éŸ³é‡ã‚’ä¸Šã’ã¦ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
        </div>
        <button id="start-button" onclick="showTitle()">â–  èµ·å‹• (CLICK TO START)</button>
    </div>
</div>

<div id="title-screen" onclick="startGame()">
    <div id="title-screen-bg"></div>
    <div id="title-content">
        <div id="title-main">åŸ‹ã¾ã‚‰ãªã„äºˆå®Ÿå·®ã®é—‡</div>
        <div id="title-sub">â€” The Unfillable Variance â€”</div>
        <div id="title-click">- Click to Start -</div>
    </div>
</div>

<div id="game-wrapper" style="display:none;">
    <div id="secret-link" onclick="checkSecret()">Ï€</div>

    <div id="scene-header">
        <div id="scene-symbol"></div>
        <div id="teams-notification">
            <div class="notif-header">
                <span>Unknown User</span>
                <span>Now</span>
            </div>
            <div id="notif-content">...</div>
        </div>
    </div>
    <div id="narrative-area"></div>
    <div id="choices-container"></div>
</div>

<script src="audio.js"></script>
<script>
    /* =========================================
       ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡ (Audio & Image)
       ========================================= */
    // AudioEngineã‚’ãƒ©ãƒƒãƒ—ã—ã¦å¾“æ¥ã®audioã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›
    const audio = {
        currentBgm: "",
        
        playBgm: function(filename) {
            if(this.currentBgm === filename) return;
            // filenameã«å¿œã˜ã¦AudioEngineã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
            if(filename === "opening") AudioEngine.playTitleTheme();
            else if(filename === "flashback") AudioEngine.playFlashbackTheme();
            else if(filename === "confession") AudioEngine.playConfessionTheme();
            else if(filename === "ending") AudioEngine.playEndingTheme();
            else AudioEngine.playMp3("audio/" + filename + ".mp3");
            this.currentBgm = filename;
        },
        stopBgm: function() {
            AudioEngine.stopMusic();
            this.currentBgm = "";
        }
    };

    const visuals = {
        bg: document.getElementById("bg-layer"),
        cg: document.getElementById("cg-image"),
        
        setBg: function(filename) {
            if(!filename) return;
            this.bg.style.backgroundImage = `url('images/${filename}.jpg')`;
        },
        setCg: function(filename) {
            if(!filename) {
                this.cg.style.opacity = 0;
            } else {
                this.cg.src = `images/${filename}.png`;
                this.cg.style.opacity = 1;
            }
        }
    };

    // èµ·å‹•ç”»é¢ã®ã‚²ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    window.addEventListener('load', function() {
        setTimeout(() => {
            document.getElementById("gauge-fill").style.width = "75%";
        }, 500);
    });

    // èµ·å‹•ç”»é¢ â†’ ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢
    function showTitle() {
        const startScreen = document.getElementById("start-screen");
        const titleScreen = document.getElementById("title-screen");
        const btn = document.getElementById("start-button");
        
        // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
        btn.disabled = true;
        btn.innerText = "â–  èµ·å‹•ä¸­...";
        
        // ã‚²ãƒ¼ã‚¸ã‚’100%ã«
        document.getElementById("gauge-fill").style.width = "100%";
        
        // BGMé–‹å§‹
        audio.playBgm("opening"); 

        setTimeout(() => {
            startScreen.style.transition = "opacity 1s";
            startScreen.style.opacity = 0;
            setTimeout(() => {
                startScreen.style.display = "none";
                titleScreen.style.display = "flex";
                titleScreen.style.opacity = 0;
                titleScreen.style.transition = "opacity 1.5s";
                setTimeout(() => {
                    titleScreen.style.opacity = 1;
                }, 50);
            }, 1000);
        }, 500);
    }

    // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ â†’ ã‚²ãƒ¼ãƒ æœ¬ç·¨
    function startGame() {
        const titleScreen = document.getElementById("title-screen");
        const game = document.getElementById("game-wrapper");
        
        titleScreen.style.transition = "opacity 1s";
        titleScreen.style.opacity = 0;
        setTimeout(() => {
            titleScreen.style.display = "none";
            game.style.display = "flex";
            render("start");
        }, 1000);
    }

    /* =========================================
       ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ & ã‚·ãƒŠãƒªã‚ª
       ========================================= */
    
    // ã€éš ã—ã‚³ãƒãƒ³ãƒ‰ã€‘Ctrl+Shift+Rã§ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
    document.addEventListener('keydown', function(e) {
        if(e.ctrlKey && e.shiftKey && e.key === 'R') {
            e.preventDefault();
            if(confirm('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem("yojitsu_save");
                alert('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚');
                location.reload();
            }
        }
    });
    
    // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç¢ºèª
    const save = JSON.parse(localStorage.getItem("yojitsu_save")) || {};
    const allCleared = save.cleared_revenge && save.cleared_logic && save.cleared_emotion && save.cleared_fear;
    const misakiRead = save.read_misaki;

    // éš ã—ãƒ«ãƒ¼ãƒˆæ¼”å‡º
    if(misakiRead) {
        document.body.classList.add("corrupted-body");
        document.getElementById("scene-header").style.filter = "hue-rotate(90deg) invert(1)";
    }

    function checkSecret() {
        if(misakiRead) {
            window.location.href = "secret_loop.html";
        } else if(allCleared) {
            if(confirm("å…¨ã¦ã®å¯èƒ½æ€§ã‚’è¦³æ¸¬ã—ã¾ã—ãŸã­ï¼Ÿ\nè£å´ã®è¨˜éŒ²ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã‹ï¼Ÿ")) {
                window.location.href = "secret_misaki.html";
            }
        } else {
            alert("ã¾ã è¦³æ¸¬ã•ã‚Œã¦ã„ãªã„é‹å‘½ãŒã‚ã‚Šã¾ã™ã€‚\nå…¨ã¦ã®çµæœ«ï¼ˆ4ãƒ«ãƒ¼ãƒˆï¼‰ã‚’è¦‹å±Šã‘ã¦ãã ã•ã„ã€‚");
        }
    }

    const scenes = {
        // --- å°å…¥ ---
        start: {
            icon: "ğŸ¢",
            bg: "bg_office_night",
            ambience: "office",
            text: `
                <p>202Xå¹´ 4æœˆ15æ—¥ æ·±å¤œ2:15ã€‚è²¡å‹™çµŒç†éƒ¨ãƒ•ãƒ­ã‚¢ã€‚</p>
                <p>ã‚ªãƒ•ã‚£ã‚¹ã®ç©ºèª¿ãŒã€ç£ã®å¯æ¯ã®ã‚ˆã†ãªä½ã„å”¸ã‚Šå£°ã‚’ä¸Šã’ã¦ã„ã‚‹ã€‚<br>
                æ·±å¤œ2æ™‚ã‚’éããŸãƒ•ãƒ­ã‚¢ã¯ã€æ·±æµ·ã®ã‚ˆã†ãªé™å¯‚ã¨ã€å†·ãˆåˆ‡ã£ãŸç©ºæ°—ã«åŒ…ã¾ã‚Œã¦ã„ãŸã€‚<br>
                ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å©ãè‡ªåˆ†ã®æŒ‡å…ˆã®éŸ³ã ã‘ãŒã€ä¹¾ã„ãŸãƒªã‚ºãƒ ã§éŸ¿ã„ã¦ã„ã‚‹ã€‚ã‚«ãƒãƒ£ã€ã‚«ãƒãƒ£ã€ã‚«ãƒãƒ£ã€‚</p>
                <p>ã€Œâ€¦â€¦åˆã‚ãªã„ã€</p>
                <p>ç‹¬ã‚Šè¨€ãŒã€å¸éŸ³æã®è²¼ã‚‰ã‚ŒãŸå¤©äº•ã«å¸ã„è¾¼ã¾ã‚Œã¦æ¶ˆãˆã‚‹ã€‚<br>
                æœŸæœ«æ±ºç®—ã®æœ€çµ‚ç¢ºå®šæ—¥ã€‚ç§ã¯ä¸€äººã€è†¨å¤§ãªæ•°å­—ã®ç¾…åˆ—ã¨æ ¼é—˜ã—ã¦ã„ãŸã€‚<br>
                1å††ã®ã‚ºãƒ¬ã‚‚è¨±ã•ã‚Œãªã„ã€‚ãã‚ŒãŒè²¡å‹™ä¼šè¨ˆã®ä»•äº‹ã ã€‚<br>
                éå»ã®å®Ÿç¸¾ã‚’ç©ã¿ä¸Šã’ã€ç¢ºå®šã•ã›ã‚‹ã“ã¨ã€‚æ­»ã‚“ã æ™‚é–“ã‚’ãƒ›ãƒ«ãƒãƒªãƒ³æ¼¬ã‘ã®æ¨™æœ¬ã«ã™ã‚‹ã‚ˆã†ãªã€å†·å¾¹ãªä½œæ¥­ã ã€‚</p>
                <p>ãµã¨ã€å…¥åŠ›ã‚’æ­¢ã‚ã¦é¡”ã‚’ä¸Šã’ã‚‹ã€‚<br>
                ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®å‘ã“ã†å´ã«ã‚ã‚‹ã€Œå³¶ã€ã¯ã€é—‡ã«æ²ˆã‚“ã§ã„ã‚‹ã€‚<br>
                ãã®ä¸€è§’ã«ã€ä¸»ã‚’å¤±ã£ãŸãƒ‡ã‚¹ã‚¯ãŒã‚ã£ãŸã€‚<br>
                3ãƒ¶æœˆå‰ã«è‡ªã‚‰å‘½ã‚’çµ¶ã£ãŸã€FP&Aï¼ˆçµŒå–¶ç®¡ç†ï¼‰æ‹…å½“â€•â€•<span class="highlight">ç¾å’²</span>ã®å¸­ã ã€‚</p>
                <p>å½¼å¥³ã¯ã€Œæœªæ¥ï¼ˆäºˆç®—ï¼‰ã€ã‚’ä½œã‚‹ä»•äº‹ã‚’ã—ã¦ã„ãŸã€‚<br>
                éå»ã‚’è¦‹ã‚‹ç§ã¨ã€æœªæ¥ã‚’è¦‹ã‚‹å½¼å¥³ã€‚<br>
                ç§ãŸã¡ã¯ã€ã†ã¾ãã„ã£ã¦ã„ã‚‹ã¯ãšã ã£ãŸã€‚â€¦â€¦ã‚ã®æ—¥ã¾ã§ã¯ã€‚</p>
            `,
            choices: [
                { text: "ç¾å’²ã®ãƒ‡ã‚¹ã‚¯ã«è¿‘ã¥ã„ã¦ã¿ã‚‹", next: "investigate_desk" },
                { text: "ä½™è¨ˆãªã“ã¨ã¯è€ƒãˆãšã€ä»•äº‹ã«æˆ»ã‚‹", next: "force_work" }
            ]
        },
        // --- ãƒ‡ã‚¹ã‚¯èª¿æŸ» ---
        investigate_desk: {
            icon: "ğŸ¥€",
            bg: "bg_misaki_desk",
            cg: "cg_hand_cream",
            music: "flashback",
            text: `
                <p>ç§ã¯æ¤…å­ã‚’è»‹ã¾ã›ã¦ç«‹ã¡ä¸ŠãŒã‚Šã€è–„æš—ã„é€šè·¯ã‚’æ­©ã„ã¦å½¼å¥³ã®ãƒ‡ã‚¹ã‚¯ã¸ã¨è¿‘ã¥ã„ãŸã€‚<br>
                ãã“ã ã‘ç©ºæ°—ãŒæ¾±ã¿ã€æ™‚é–“ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ã‚ˆã†ã«æ„Ÿã˜ã‚‹ã€‚</p>
                <p>ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¯ã†ã£ã™ã‚‰ã¨åŸƒãŒç©ã‚‚ã£ã¦ã„ã‚‹ã€‚<br>
                å“ä¸Šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯3æœˆã§æ­¢ã¾ã£ãŸã¾ã¾ã ã€‚<br>
                ç«¯ã«ç½®ã‹ã‚ŒãŸè¦³è‘‰æ¤ç‰©ã¯å®Œå…¨ã«æ¯ã‚Œæœã¦ã€èŒ¶è‰²ã„éª¸ã‚’æ™’ã—ã¦ã„ãŸã€‚</p>
                <p>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ä¸‹ã«ã€é»„è‰²ã„ä»˜ç®‹ãŒæŒŸã¾ã£ã¦ã„ã‚‹ã®ãŒè¦‹ãˆãŸã€‚<br>
                éœ‡ãˆã‚‹æ‰‹ã§ãã‚Œã‚’å¼•ãæŠœãã€‚</p>
                <p style="font-family:serif; font-style:italic; border:1px solid #333; padding:15px; margin:20px 0;">
                ã€ç§ã¯ã€æ¶ˆè²»ã•ã‚Œã‚‹ã ã‘ã®å‚™å“ã˜ã‚ƒãªã„ã€
                </p>
                <p>æ®´ã‚Šæ›¸ãã®ã‚ˆã†ãªç­†è·¡ã€‚<br>
                å½¼å¥³ã‚’ã“ã“ã¾ã§è¿½ã„è©°ã‚ãŸã®ã¯èª°ã ï¼Ÿ<br>
                ãã—ã¦ã€ãã‚Œã«æ°—ã¥ã‘ãªã‹ã£ãŸç§ã«ã‚‚ã€ãã®ç½ªã®ä¸€ç«¯ã¯ã‚ã‚‹ã®ã§ã¯ãªã„ã‹ã€‚</p>
                <p>èƒ¸ãŒç· ã‚ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ãªç½ªæ‚ªæ„Ÿã«è¥²ã‚ã‚ŒãŸã€ãã®æ™‚ã ã£ãŸã€‚</p>
            `,
            choices: [
                { text: "â€¦â€¦å¸­ã«æˆ»ã‚ã†", next: "incident_trigger" }
            ]
        },
        // --- ä»•äº‹å¼·è¡Œ ---
        force_work: {
            icon: "ğŸ“‰",
            bg: "bg_office_night",
            cg: "",
            sound: "glitch",
            text: `
                <p>æ„Ÿå‚·ã«æµ¸ã£ã¦ã„ã‚‹æ™‚é–“ã¯ãªã„ã€‚<br>
                ç§ãŒæ•°å­—ã‚’åˆã‚ã›ãªã‘ã‚Œã°ã€æ˜æ—¥ã®å½¹å“¡ä¼šã§çµŒç†éƒ¨é•·ãŒæ¥ã‚’ã‹ãã€‚<br>
                ãã†ã™ã‚Œã°ã€ã¾ãŸã‚ã®æ€’é³´ã‚Šå£°ãŒãƒ•ãƒ­ã‚¢ã«éŸ¿ãã“ã¨ã«ãªã‚‹ã€‚</p>
                <p>ç§ã¯è¦–ç·šã‚’ç¾å’²ã®å¸­ã‹ã‚‰å‰¥ãŒã—ã€å†ã³ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«å‘ãç›´ã£ãŸã€‚<br>
                Excelã®ã‚»ãƒ«ãŒã€ç„¡é™ã«ç¶šãç‰¢ç„ã®æ ¼å­ã®ã‚ˆã†ã«è¦‹ãˆã¦ãã‚‹ã€‚</p>
                <p>ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’å©ãã€‚ã‚«ãƒãƒ£ã€ã‚«ãƒãƒ£ã€‚<br>
                â€¦â€¦éŸ³ãŒã€ã‚„ã‘ã«éŸ¿ãã€‚</p>
                <p>ãµã¨ã€ã‚»ãƒ«ã®æ•°å€¤ãŒãŠã‹ã—ã„ã“ã¨ã«æ°—ã¥ãã€‚<br>
                ã€444ã€ã€444ã€ã€444ã€<br>
                ãƒãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚‚æ¶ˆãˆãªã„ã€‚<br>
                ã‚ˆãè¦‹ã‚‹ã¨ã€æ•°å­—ã§ã¯ãªã„ã€‚<br>
                <span class="glitch-text">ã€DIEã€ã€HELPã€ã€URAGIRIMONOã€</span></p>
                <p>ã€Œç–²ã‚Œã¦ã„ã‚‹ã‚“ã â€¦â€¦ã€<br>
                ç›®é ­ã‚’æŠ¼ã•ãˆãŸã€ãã®æ™‚ã ã£ãŸã€‚</p>
            `,
            choices: [
                { text: "ãªã€ãªã‚“ã â€¦â€¦ï¼Ÿ", next: "incident_trigger" }
            ]
        },
        // --- é€šçŸ¥ã‚¤ãƒ™ãƒ³ãƒˆ ---
        incident_trigger: {
            icon: "ğŸ””",
            bg: "bg_office_night",
            sound: "ping",
            music: "stop",
            action: { popup: "ä»¶å: äºˆå®Ÿå·®ç•°ï¼ˆVarianceï¼‰ã®å ±å‘Š<br><br>ã­ãˆã€å®Ÿç¸¾ãŒåˆã‚ãªã„ã‚ˆã€‚<br>ç§ãŒç”ŸããŸã‹ã£ãŸæœªæ¥ã¨ã€æ­»ã‚“ã ç¾å®Ÿã®å·®ãŒåŸ‹ã¾ã‚‰ãªã„ã®ã€‚" },
            text: `
                <p><strong style="color:#6264a7; font-size:1.3rem;">ãƒ”ãƒ³ï¼â™ª</strong></p>
                <p>é™å¯‚ã‚’åˆ‡ã‚Šè£‚ãã€è»½å¿«ã§é›»å­çš„ãªé€šçŸ¥éŸ³ã€‚<br>
                å¿ƒè‡“ãŒè·³ã­ä¸ŠãŒã‚‹ã€‚<br>
                Microsoft Teamsã®ç€ä¿¡éŸ³ã ã€‚<br>
                ã“ã‚“ãªæ™‚é–“ã«ï¼Ÿ èª°ãŒï¼Ÿ</p>
                <p>æã‚‹æã‚‹ç”»é¢ã®å³ä¸‹ã‚’è¦‹ã‚‹ã€‚<br>
                ç´«è‰²ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒã€ã‚†ã£ãã‚Šã¨æµ®ã‹ã³ä¸ŠãŒã£ã¦ããŸã€‚</p>
                <p>å·®å‡ºäººï¼š<span class="highlight">Unknown User</span></p>
                <p>æ¯ãŒæ­¢ã¾ã‚‹ã‹ã¨æ€ã£ãŸã€‚<br>
                ã€äºˆå®Ÿå·®ç•°ã€â€¦â€¦ãã‚Œã¯ã€FP&Aæ‹…å½“ã ã£ãŸç¾å’²ã®å£ç™–ã ã€‚<br>
                å‰Šé™¤ã•ã‚ŒãŸã¯ãšã®å½¼å¥³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã€äº¡éœŠã®ã‚ˆã†ã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å½·å¾¨ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ</p>
            `,
            choices: [
                { text: "é€šçŸ¥ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹ã", next: "message_reveal" },
                { text: "ã€Œã‚¹ãƒ‘ãƒ ã ã€ã¨åˆ¤æ–­ã—ã€å‰Šé™¤ã‚’è©¦ã¿ã‚‹", next: "attempt_ignore" }
            ]
        },
        // --- æ‹’çµ¶ã®ä»£å„Ÿ ---
        attempt_ignore: {
            icon: "ğŸš«",
            bg: "bg_office_night",
            synth: "horror",
            sound: "glitch",
            text: `
                <p>ã€Œâ€¦â€¦é¦¬é¹¿ãªã€‚èª°ã‹ã®æ‚ªè³ªãªæ‚ªæˆ¯ã ã€</p>
                <p>ç§ã¯è‡ªåˆ†ã«è¨€ã„èã‹ã›ã‚‹ã‚ˆã†ã«å‘Ÿãã€ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’é€šçŸ¥ã®ã€ŒÃ—ã€ãƒœã‚¿ãƒ³ã¸å‹•ã‹ã—ãŸã€‚<br>
                é–¢ã‚ã£ã¦ã¯ã„ã‘ãªã„ã€‚ã“ã‚Œã¯è¦‹ã¦ã¯ã„ã‘ãªã„ã‚‚ã®ã ã€‚</p>
                <p>ã—ã‹ã—ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒã€ŒÃ—ã€ã«é‡ãªã£ãŸç¬é–“ã€ã¾ã‚‹ã§ç£çŸ³ã®åŒæ¥µåŒå£«ã®ã‚ˆã†ã«ã€ã‚«ãƒ¼ã‚½ãƒ«ãŒå¼¾ã‹ã‚ŒãŸã€‚<br>
                ã€Œãªã£â€¦â€¦ï¼ï¼Ÿã€</p>
                <p>ä½•åº¦ã‚„ã£ã¦ã‚‚ã€é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ãªã„ã€‚<br>
                ãã‚Œã©ã“ã‚ã‹ã€ç”»é¢ä¸Šã®æ–‡å­—ãŒèµ¤ãå¤‰è‰²ã—å§‹ã‚ãŸã€‚</p>
                <p class="ghost-voice">ã€ç„¡è¦–ã‚¹ãƒ«ãƒï¼Ÿ<br>ãƒã‚¿ã€ç§ãƒ²ç„¡è¦–ã‚¹ãƒ«ãƒï¼Ÿã€</p>
                <p>PCã®ãƒ•ã‚¡ãƒ³ãŒæ‚²é³´ã®ã‚ˆã†ãªå›è»¢éŸ³ã‚’ä¸Šã’ã€ç”»é¢ãŒæ¿€ã—ãæ˜æ»…ã™ã‚‹ã€‚<br>
                æ¬¡ã®ç¬é–“ã€ç§ã®æ„æ€ã¨ã¯ç„¡é–¢ä¿‚ã«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒå¼·åˆ¶çš„ã«å±•é–‹ã•ã‚ŒãŸã€‚</p>
            `,
            choices: [
                { text: "â€¦â€¦ï¼ï¼", next: "message_reveal" }
            ]
        },
        // --- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–‹ç¤º ---
        message_reveal: {
            icon: "ğŸ’»",
            bg: "bg_office_night",
            cg: "cg_misaki_ghost_hollow",
            music: "confession",
            text: `
                <p>ç§ã¯éœ‡ãˆã‚‹æŒ‡ã§ãƒã‚¦ã‚¹ã‚’æ“ä½œã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é–‹ã„ãŸã€‚ï¼ˆã‚ã‚‹ã„ã¯ã€å‹æ‰‹ã«é–‹ã‹ã‚ŒãŸã€‚ï¼‰</p>
                <p class="ghost-voice">
                ã€ã­ãˆã€äºœä¹…æ–—ãã‚“ã€‚<br>
                ãªã‚“ã§ã‚ã®æ—¥ã€é›»è©±ã«å‡ºã¦ãã‚Œãªã‹ã£ãŸã®ï¼Ÿ<br>
                ç§ã®ã“ã¨ã€è¦‹æ¨ã¦ãŸã®ï¼Ÿã€
                </p>
                <p>ç”»é¢ã®æ–‡å­—ãŒæ»²ã¿ã€èµ¤é»’ãå¤‰è‰²ã—ã¦ã„ãã€‚<br>
                ã“ã‚Œã¯ãƒã‚°ã§ã¯ãªã„ã€‚ãƒãƒƒã‚­ãƒ³ã‚°ã§ã‚‚ãªã„ã€‚<br>
                ãã“ã«ã€Œå½¼å¥³ã€ãŒã„ã‚‹ã®ã ã€‚</p>
                <p>ã€Œç¾å’²â€¦â€¦ãªã®ã‹ï¼Ÿã€</p>
                <p>å£°ã«å‡ºã—ã¦å•ã„ã‹ã‘ã‚‹ã€‚<br>
                PCã®å†·å´ãƒ•ã‚¡ãƒ³ãŒå”¸ã‚Šã‚’ä¸Šã’ã€ã¾ã‚‹ã§è‹¦ç—›ã®å«ã³ã®ã‚ˆã†ã«èã“ãˆãŸã€‚</p>
                <p class="ghost-voice">
                ã€æ˜æ—¥ã€å®Ÿå®¶ã«æ¥ã¦ã€‚<br>
                ãƒãƒãŒå¾…ã£ã¦ã‚‹ã€‚<br>
                ãã“ã§ç§ã®ã€Œæœªå‡¦ç†æ®‹é«˜ã€ã‚’ç²¾ç®—ã—ã¦ã€‚ã€
                </p>
                <p>ãã‚Œã¯å‘ªã„ã®æ‹›å¾…çŠ¶ã‹ã€ãã‚Œã¨ã‚‚æ•‘æ¸ˆã®é¡˜ã„ã‹ã€‚<br>
                é€ƒã’ã‚‹ã“ã¨ã¯è¨±ã•ã‚Œãªã„ã€‚<br>
                ã“ã®ä¸å¯è§£ãªç¾è±¡ã«å¯¾ã—ã€ç§ã®å¿ƒã¯æ¿€ã—ãæºã‚Œå‹•ã„ãŸã€‚</p>
            `,
            choices: [
                { text: "è‡ªåˆ†ã®ã€Œå¿ƒã€ã‚’æ±ºã‚ã‚‹", next: "final_choice" }
            ]
        },
        // --- æœ€çµ‚åˆ†å² ---
        final_choice: {
            icon: "âš–ï¸",
            bg: "bg_office_night",
            cg: "cg_misaki_ghost_hollow",
            ambience: "abyss",
            text: `
                <p>ã‚ªãƒ•ã‚£ã‚¹ã®ç…§æ˜ãŒæ˜æ»…ã‚’å§‹ã‚ã‚‹ã€‚<br>
                å½¼å¥³ã®æ°—é…ãŒã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‹ã‚‰æº¢ã‚Œå‡ºã—ã€ç§ã®é¦–ç­‹ã‚’æ’«ã§ã¦ã„ã‚‹ã€‚<br>
                ã©ã†ã™ã‚‹ï¼Ÿ<br>
                ã“ã®ææ€–ã¨ã€ç½ªæ‚ªæ„Ÿã¨ã€å¾Œæ‚”ã«ã€ã©ã†å‘ãåˆã†ï¼Ÿ</p>
                <p>ã“ã“ã§ã®é¸æŠãŒã€ç§ã®é‹å‘½â€•â€•ãã—ã¦ç‰©èªã®çµæœ«ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ã‚’æ±ºå®šã¥ã‘ã‚‹ã€‚</p>
            `,
            choices: [
                { text: "ã€è«–ç†ã€‘èª°ã‹ã®æ‚ªæˆ¯ã ã€‚ãƒ­ã‚°ã‚’è§£æã—ã¦æ­£ä½“ã‚’æš´ã", next: "route_logic", class: "btn-route route-logic" },
                { text: "ã€æ„›åŸ·ã€‘ç¾å’²â€¦â€¦ï¼ æ¶™ã‚’æµã—ãªãŒã‚‰è¬ç½ªã™ã‚‹", next: "route_emotion", class: "btn-route route-emotion" },
                { text: "ã€ææ€–ã€‘è¦‹ãªã‹ã£ãŸã“ã¨ã«ã—ã¦ã€éœ‡ãˆãªãŒã‚‰PCã‚’é–‰ã˜ã‚‹", next: "route_fear", class: "btn-route route-fear" },
                { text: "ã€æ®ºæ„ã€‘ã€Œãµã–ã‘ã‚‹ãªï¼ã€ã¨æ€’é³´ã‚Šã€å¾©è®ã®é“ã‚’é¸ã¶", next: "route_revenge", class: "btn-route route-revenge" }
            ]
        }
    };

    const dom = {
        text: document.getElementById("narrative-area"),
        choices: document.getElementById("choices-container"),
        notif: document.getElementById("teams-notification"),
        notifContent: document.getElementById("notif-content"),
        header: document.getElementById("scene-header")
    };

    function render(sceneId) {
        window.scrollTo(0,0);

        if(sceneId.startsWith("route_")) {
            const routeName = sceneId.split("_")[1];
            let karma = 0;
            if(routeName === "revenge") karma = 50;
            if(routeName === "fear") karma = 0;
            
            const oldSave = JSON.parse(localStorage.getItem("yojitsu_save")) || {};
            oldSave.route = routeName;
            oldSave.sanity = 100;
            oldSave.karma = karma;
            localStorage.setItem("yojitsu_save", JSON.stringify(oldSave));

            window.location.href = `route_${routeName}.html`;
            return;
        }

        const scene = scenes[sceneId];
        
        // --- ç”»åƒãƒ»éŸ³å£°åˆ¶å¾¡ ---
        if(scene) {
            visuals.setBg(scene.bg);
            visuals.setCg(scene.cg);
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚‚èƒŒæ™¯ç”»åƒã‚’è¨­å®š
            if(scene.bg) {
                dom.header.style.backgroundImage = `url('images/${scene.bg}.jpg')`;
            }
            
            // éŸ³æ¥½åˆ¶å¾¡ï¼ˆå„ªå…ˆé †ä½: ambience > synth > musicï¼‰
            if(scene.music === "stop") {
                audio.stopBgm();
            } else if(scene.ambience) {
                // ã‚·ãƒ³ã‚»ç’°å¢ƒéŸ³
                AudioEngine.playAmbience(scene.ambience);
            } else if(scene.synth) {
                // ã‚·ãƒ³ã‚»BGM
                if(scene.synth === "horror") AudioEngine.playHorrorTheme();
                else if(scene.synth === "mystery") AudioEngine.playMysteryTheme();
                else if(scene.synth === "chase") AudioEngine.playChaseTheme();
            } else if(scene.music) {
                // MP3å†ç”Ÿ
                audio.playBgm(scene.music);
            }

            if(scene.sound) {
                // AudioEngineã®ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼ã‚’ä½¿ç”¨
                if(scene.sound === "ping") AudioEngine.playPing();
                else if(scene.sound === "glitch") AudioEngine.playGlitch();
                else if(scene.sound === "heart") AudioEngine.playHeartbeat();
                else if(scene.sound === "slam") AudioEngine.playSlam();
                
                if(scene.sound === "ping") {
                    // é€šçŸ¥éŸ³ã®æ™‚ã®ç‰¹åˆ¥æ¼”å‡º
                    setTimeout(() => AudioEngine.playHeartbeat(), 500);
                }
            }

            if(scene.action && scene.action.popup) {
                dom.notifContent.innerHTML = scene.action.popup;
                dom.notif.classList.add("active");
            }
        }

        dom.text.innerHTML = scene.text;
        dom.text.animate([{opacity:0}, {opacity:1}], {duration: 1000, fill:"forwards"});

        dom.choices.innerHTML = "";
        
        if(misakiRead && sceneId === "final_choice") {
             const btn = document.createElement("button");
             btn.innerText = "é€ƒã‚²ãƒ©ãƒ¬ãƒŠã‚¤";
             btn.className = "corrupted-btn";
             btn.onclick = () => alert("ç„¡é§„ãƒ€ãƒ¨");
             dom.choices.appendChild(btn);
             return;
        }

        scene.choices.forEach(c => {
            const btn = document.createElement("button");
            btn.innerHTML = c.text;
            if(c.class) btn.className = `btn-route ${c.class}`;
            btn.onclick = () => render(c.next);
            dom.choices.appendChild(btn);
        });
    }

    if(allCleared) {
        const link = document.getElementById("secret-link");
        link.style.color = "#333";
        if(misakiRead) link.innerText = "â˜ ";
    }

    // åˆæœŸåŒ–ã¯ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã§
</script>
</body>
</html>