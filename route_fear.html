<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸ‹ã¾ã‚‰ãªã„äºˆå®Ÿå·®ã®é—‡ - Chapter 1: Fear</title>
<style>
    /* â–¼â–¼â–¼ ææ€–ã®ç´«ã¨ç²¾ç¥å´©å£Š â–¼â–¼â–¼ */
    :root {
        --bg-color: #050005;
        --text-main: #d0c0d0;
        --accent-purple: #9013fe;
        --accent-fear: #cc00ff;
        --accent-blood: #880000;
    }

    body {
        background-color: var(--bg-color);
        color: var(--text-main);
        font-family: "Yu Mincho", "Hiragino Mincho ProN", serif;
        line-height: 2.5;
        letter-spacing: 0.05em;
        margin: 0;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden; /* èƒŒæ™¯ç”»åƒç”¨ */
    }

    /* === ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€  === */
    #layer-group {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        z-index: -1; pointer-events: none;
    }
    #bg-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-size: cover; background-position: center;
        transition: opacity 0.2s ease; /* ææ€–æ¼”å‡ºã®ãŸã‚åˆ‡ã‚Šæ›¿ãˆã‚’æ—©ã */
        opacity: 0.5;
        filter: contrast(1.2) brightness(0.6); /* æš—ãã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå¼·ã */
    }
    #cg-layer {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
    }
    #cg-image {
        max-height: 90%; max-width: 90%;
        opacity: 0; transition: opacity 0.1s ease; /* ãƒ‘ãƒƒã¨å‡ºã‚‹ */
        filter: drop-shadow(0 0 20px #f00); /* èµ¤ã„å½± */
    }

    /* ææ€–æ¼”å‡ºï¼ˆãƒã‚¤ã‚ºã¨æ­ªã¿ï¼‰ */
    .noise-overlay {
        position: absolute; top:0; left:0; width:100%; height:100%;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
        opacity: 0.3; pointer-events: none;
        mix-blend-mode: overlay;
    }

    #game-wrapper {
        width: 100%;
        max-width: 840px;
        height: 95vh;
        background-color: rgba(16, 0, 16, 0.85);
        box-shadow: 0 0 80px rgba(100, 0, 100, 0.2);
        display: flex;
        flex-direction: column;
        border: 1px solid #330033;
        position: relative;
        overflow-y: auto;
    }

    /* ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ */
    #scene-header {
        height: 200px;
        background-size: cover;
        background-position: center;
        display: flex; align-items: center; justify-content: center;
        position: relative; overflow: hidden;
        border-bottom: 1px solid #220022;
        flex-shrink: 0;
        transition: background-image 0.5s ease;
    }
    #scene-header::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(180deg, rgba(15,0,15,0.6) 0%, rgba(0,0,0,0.85) 100%);
        z-index: 1;
    }
    /* æŠ½è±¡çš„ã‚·ãƒ³ãƒœãƒ«ï¼ˆæ­ªã‚“ã ç©ºæ´ï¼‰ */
    #scene-symbol {
        width: 40px; height: 40px;
        border: 1px solid rgba(144,19,254,0.25);
        border-radius: 40% 60% 60% 40% / 60% 40% 60% 40%;
        position: relative;
        opacity: 0.4;
        z-index: 2;
        animation: morph 8s ease-in-out infinite;
    }
    @keyframes morph {
        0%, 100% { border-radius: 40% 60% 60% 40% / 60% 40% 60% 40%; }
        50% { border-radius: 60% 40% 40% 60% / 40% 60% 40% 60%; }
    }
    #scene-symbol::after {
        content: ''; position: absolute;
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 12px; height: 12px;
        background: rgba(144,19,254,0.2);
        border-radius: 50%;
    }
    
    /* æœ¬æ–‡ã‚¨ãƒªã‚¢ */
    #narrative-area {
        padding: 40px 50px;
        flex-grow: 1;
        font-size: 1.1rem;
        text-align: justify;
    }
    p { margin-bottom: 2.5em; opacity: 0; animation: fadeIn 1s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }

    .highlight { color: var(--accent-purple); font-weight: bold; }
    .scream { color: var(--accent-fear); font-weight: bold; font-size: 1.1em; letter-spacing: 0.2em; }
    
    /* äº¡éœŠã®å£°ï¼ˆæ­ªã‚“ã§èã“ãˆã‚‹ï¼‰ */
    .ghost-voice { 
        color: var(--accent-fear); font-family: "Courier New", monospace;
        text-shadow: 2px 2px 0px #000, -1px -1px 0 #500;
        border-left: 3px solid var(--accent-purple); padding-left: 20px; margin: 2em 0;
        letter-spacing: 0.15em;
    }

    /* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ */
    .ending-card {
        margin-top: 50px; padding: 40px; border: 1px solid #666; text-align: center;
        color: #888; opacity: 0; animation: fadeIn 3s forwards; animation-delay: 1s;
        background: rgba(0,0,0,0.8);
    }
    .end-title { font-size: 2rem; margin-bottom: 20px; letter-spacing: 0.2em; font-weight: bold; color: #666; }

    /* é¸æŠè‚¢ã‚¨ãƒªã‚¢ */
    #choices-container {
        padding: 40px 60px 80px;
        display: flex; flex-direction: column; gap: 20px;
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(16,0,16,0.9) 100%);
        border-top: 1px solid #330033;
    }
    button {
        background: rgba(26,5,26,0.9); color: #d0a0d0; border: 1px solid #440044;
        padding: 25px 30px; text-align: left; 
        font-family: "Yu Mincho", serif; font-size: 1.05rem;
        cursor: pointer; transition: all 0.3s; position: relative;
    }
    button:hover { background: #330033; color: #fff; border-color: #f0f; padding-left: 40px; box-shadow: 0 0 20px rgba(200, 0, 255, 0.3); }
    button::before { content: "ğŸ‘ï¸"; position: absolute; left: 15px; opacity: 0; transition: opacity 0.3s; font-size: 0.8em; }
    button:hover::before { opacity: 1; }
    
    /* æ‹’çµ¶ãƒœã‚¿ãƒ³ */
    .btn-refuse { border-color: #888; color: #aaa; }
    .btn-refuse:hover { background: #222; border-color: #fff; box-shadow: none; }

</style>
</head>
<body>

<div id="layer-group">
    <div id="bg-layer"></div>
    <div id="cg-layer"><img id="cg-image" src="" alt=""></div>
</div>

<div id="game-wrapper">
    <div id="scene-header">
        <div id="scene-symbol"></div>
        <div class="noise-overlay"></div>
    </div>

    <div id="narrative-area"></div>
    <div id="choices-container"></div>
</div>

<script src="audio.js"></script>
<script>
    /* =========================================
       ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡ (Audio & Image)
       ========================================= */
    // AudioEngine ãƒ©ãƒƒãƒ‘ãƒ¼
    const audio = {
        currentBgm: "",
        
        playBgm: function(filename) {
            if(this.currentBgm === filename) return;
            this.currentBgm = filename;
            
            if(filename === "bgm_ending") AudioEngine.playEndingTheme();
            else if(filename === "bgm_flashback") AudioEngine.playFlashbackTheme();
            else if(filename === "bgm_confession") AudioEngine.playConfessionTheme();
            else if(filename === "bgm_rain") AudioEngine.playAmbience("rain");
            else if(filename === "bgm_mystery") AudioEngine.playMysteryTheme();
            else if(filename === "bgm_horror") AudioEngine.playHorrorTheme();
            else if(filename === "bgm_chase") AudioEngine.playChaseTheme();
            else if(filename === "bgm_office") AudioEngine.playAmbience("office");
            else if(filename === "bgm_abyss") AudioEngine.playAmbience("abyss");
            else if(filename === "bgm_tinnitus") AudioEngine.playAmbience("tinnitus");
            else console.log("Unknown BGM:", filename);
        },
        stopBgm: function() {
            AudioEngine.stopMusic();
            this.currentBgm = "";
        },
        playSe: function(filename) {
            if(filename === "se_ping") AudioEngine.playPing();
            else if(filename === "se_glitch") AudioEngine.playGlitch();
            else if(filename === "se_slam") AudioEngine.playSlam();
            else if(filename === "se_execution") AudioEngine.playExecution();
            else if(filename === "se_impact") AudioEngine.playImpact();
            else if(filename === "se_heartbeat" || filename === "se_heart") AudioEngine.playHeartbeat();
            else if(filename === "se_shredder") AudioEngine.playShredder();
            else if(filename === "se_stamp") AudioEngine.playStamp();
            else console.log("Unknown SE:", filename);
        }
    };

    const visuals = {
        bg: document.getElementById("bg-layer"),
        cg: document.getElementById("cg-image"),
        
        setBg: function(filename) {
            if(!filename) return;
            this.bg.style.backgroundImage = `url('images/${filename}.jpg')`;
        },
        setCg: function(filename) {
            if(!filename) {
                this.cg.style.opacity = 0;
            } else {
                this.cg.src = `images/${filename}.png`;
                this.cg.style.opacity = 1;
            }
        },
        setFilter: function(type) {
            if(type === "blood") {
                this.bg.style.filter = "sepia(0.5) hue-rotate(-50deg) saturate(3) contrast(1.5)"; // çœŸã£èµ¤
            } else {
                this.bg.style.filter = "contrast(1.2) brightness(0.6)"; // é€šå¸¸ï¼ˆæš—ã„ï¼‰
            }
        }
    };

    // â–¼â–¼â–¼ ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ï¼ˆææ€–ç·¨ï¼šç”»åƒãƒ»éŸ³å£°çµ±åˆç‰ˆï¼‰ â–¼â–¼â–¼
    const scenes = {
        // --- å°å…¥ï¼šæ‹’çµ¶ã¨é€ƒèµ° ---
        start: {
            icon: "ğŸƒ",
            bg: "bg_office_night",    // â˜…èƒŒæ™¯ï¼šã‚ªãƒ•ã‚£ã‚¹
            cg: "",
            sound: "se_glitch",       // â˜…SEï¼šãƒã‚¤ã‚º
            music: "bgm_chase",       // â˜…BGMï¼šè¿½è·¡
            text: `
                <span class="name">æ·±å¤œ2:20 è²¡å‹™çµŒç†éƒ¨ãƒ•ãƒ­ã‚¢</span>
                <p>
                ã€Œã„ã€å«Œã â€¦â€¦è¦‹ãŸããªã„â€¦â€¦ï¼ã€
                </p>
                <p>
                ç§ã¯æ‚²é³´ã«è¿‘ã„å£°ã‚’ä¸Šã’ã€åå°„çš„ã«ãƒãƒ¼ãƒˆPCã‚’é–‰ã˜ãŸã€‚<br>
                ãƒãƒãƒ³ï¼ ã¨ã„ã†ä¹¾ã„ãŸéŸ³ãŒãƒ•ãƒ­ã‚¢ã«éŸ¿ãã€‚<br>
                å¿ƒè‡“ãŒæ—©é˜ã‚’æ‰“ã£ã¦ã„ã‚‹ã€‚è„‚æ±—ãŒé¡ã‚’ä¼ã†ã€‚<br>
                æ­»ã‚“ã äººé–“ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Ÿ ã‚ã‚Šãˆãªã„ã€‚ãã‚“ãªã‚‚ã®ã¯è¦‹ãªã‹ã£ãŸã“ã¨ã«ã™ã‚Œã°ã„ã„ã€‚<br>
                é–¢ã‚ã‚‰ãªã‘ã‚Œã°ã€å­˜åœ¨ã—ãªã„ã®ã¨åŒã˜ã ã€‚
                </p>
                <p>
                ã€Œå¸°ã‚ã†ã€‚ç–²ã‚Œã¦ã‚‹ã‚“ã ã€‚ãã†ã ã€å…¨éƒ¨å¤¢ã ã€
                </p>
                <p>
                ç§ã¯éœ‡ãˆã‚‹æ‰‹ã§é„ã‚’æ´ã¿ã€é€ƒã’ã‚‹ã‚ˆã†ã«å¸­ã‚’ç«‹ã£ãŸã€‚<br>
                ã—ã‹ã—ã€ç•°å¤‰ã¯ã™ãã«èµ·ããŸã€‚<br>
                é–‰ã˜ãŸã¯ãšã®PCã‹ã‚‰ã€å†·å´ãƒ•ã‚¡ãƒ³ã®å›è»¢éŸ³ãŒèã“ãˆã‚‹ã€‚<br>
                <span class="highlight">ãƒ–ã‚©ã‚©ã‚©ã‚©ãƒ³â€¦â€¦ã€‚</span><br>
                ãã®éŸ³ã¯ã€ã¾ã‚‹ã§è‹¦æ‚¶ã™ã‚‹äººé–“ã®å‘»ãå£°ã®ã‚ˆã†ã«ã€ä½ãã€é‡è‹¦ã—ãå”¸ã£ã¦ã„ã‚‹ã€‚
                </p>
                <p>
                ãã—ã¦ã€ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ãƒã‚¤ã‚ºæ··ã˜ã‚Šã®åˆæˆéŸ³å£°ãŒæ¼ã‚Œå‡ºã—ãŸã€‚<br>
                <span class="ghost-voice">ã€é–‰ã‚¸ãƒŠã‚¤ãƒ‡ã€‚ãƒãƒ€è©±ã‚·ãƒ†ãƒ«é€”ä¸­ãƒ‡ã‚·ãƒ§ï¼Ÿã€</span>
                </p>
                <p>
                ã€Œã²ã£ï¼ï¼Ÿã€<br>
                ç§ã¯æ¤…å­ã‚’è¹´å€’ã—ã€å‡ºå£ã¸ã¨èµ°ã£ãŸã€‚<br>
                æŒ¯ã‚Šè¿”ã£ã¦ã¯ã„ã‘ãªã„ã€‚æŒ¯ã‚Šè¿”ã£ãŸã‚‰ã€ãã“ã«ã€Œã„ã‚‹ã€æ°—ãŒã™ã‚‹ã‹ã‚‰ã ã€‚
                </p>
            `,
            choices: [
                { text: "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã§é€ƒã’ã‚‹", next: "elevator_trap" },
                { text: "éå¸¸éšæ®µã§é€ƒã’ã‚‹", next: "stairs_loop" }
            ]
        },

        // --- åˆ†å²Aï¼šã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ï¼ˆé–‰é–ç©ºé–“ï¼‰ ---
        elevator_trap: {
            icon: "ğŸ›—",
            bg: "bg_elevator", // â˜…èƒŒæ™¯ï¼šã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼å†…
            cg: "",
            music: "bgm_abyss",    // â˜…Ambienceï¼šé–‰é–ç©ºé–“
            text: `
                <p>
                ç§ã¯ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ãƒ›ãƒ¼ãƒ«ã¸é§†ã‘è¾¼ã¿ã€é€£æ‰“ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã€‚<br>
                æ—©ãã€æ—©ãæ¥ã„ï¼<br>
                åˆ°ç€éŸ³ã¨å…±ã«æ‰‰ãŒé–‹ãã€‚ä¸­ã¯ç„¡äººã ã€‚<br>
                ç§ã¯é£›ã³è¾¼ã¿ã€ã€Œé–‰ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ç¶šã‘ãŸã€‚
                </p>
                <p>
                æ‰‰ãŒé–‰ã¾ã‚‹ã€‚å¯†å®¤ã®å®‰å µæ„Ÿã€‚<br>
                ã—ã‹ã—ã€å‹•ãå‡ºã—ãŸç®±ã®ä¸­ã§ã€ç…§æ˜ãŒãƒã‚«ãƒã‚«ã¨ç‚¹æ»…ã‚’å§‹ã‚ãŸã€‚
                </p>
                <p>
                ãµã¨ã€é¡ã‚’è¦‹ã‚‹ã€‚<br>
                è‡ªåˆ†ã®èƒŒå¾Œã«ã€<span class="highlight">é’ç™½ã„é¡”ã‚’ã—ãŸç¾å’²</span>ãŒç«‹ã£ã¦ã„ãŸã€‚<br>
                é¦–ãŒç›´è§’ã«æŠ˜ã‚Œæ›²ãŒã£ã¦ã„ã‚‹ã€‚
                </p>
                <p>
                <span class="scream">ã€Œã†ã‚ã‚ã‚ã‚ã‚ã‚ï¼ï¼ã€</span>
                </p>
                <p>
                é€ƒã’å ´ã®ãªã„å¯†å®¤ã§ã€å½¼å¥³ã®å†·ãŸã„æ‰‹ãŒç§ã®é¦–ã«å·»ãã¤ã„ãŸã€‚
                </p>
            `,
            choices: [
                { text: "æ„è­˜ãŒæš—è»¢ã™ã‚‹", next: "forced_pact" }
            ]
        },

        // --- åˆ†å²Bï¼šéå¸¸éšæ®µï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ï¼‰ ---
        stairs_loop: {
            icon: "ğŸªœ",
            bg: "bg_stairs_loop",  // â˜…èƒŒæ™¯ï¼šç„¡é™éšæ®µ
            cg: "",
            music: "bgm_horror",   // â˜…BGMï¼šææ€–
            text: `
                <p>
                ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¯å±é™ºã ã€‚ç§ã¯éå¸¸éšæ®µã®é‡ã„é‰„æ‰‰ã‚’æŠ¼ã—é–‹ã‘ãŸã€‚<br>
                ã‚«ãƒ„ãƒ³ã€ã‚«ãƒ„ãƒ³ã€ã‚«ãƒ„ãƒ³ã€‚<br>
                è‡ªåˆ†ã®è¶³éŸ³ãŒã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®å£ã«åéŸ¿ã—ã€ã¾ã‚‹ã§èª°ã‹ãŒè¿½ã„ã‹ã‘ã¦ãã‚‹éŸ³ã®ã‚ˆã†ã«èã“ãˆã‚‹ã€‚
                </p>
                <p>
                ã€Œã¯ãã€ã¯ãã€ã¯ãâ€¦â€¦ï¼ã€<br>
                ã“ã“ã¯4éšã ã€‚1éšã¾ã§é™ã‚Šã‚Œã°å¤–ã«å‡ºã‚‰ã‚Œã‚‹ã€‚<br>
                è¸Šã‚Šå ´ã‚’å›ã‚Šã€ä¸‹ã®éšã¸ã€‚<br>
                å£ã®éšæ•°è¡¨ç¤ºã‚’è¦‹ã‚‹ã€‚ã€3Fã€ã€‚ã‚ˆã—ã€‚ã•ã‚‰ã«é™ã‚Šã‚‹ã€‚ã€2Fã€ã€‚ã‚ã¨å°‘ã—ã€‚
                </p>
                <p>
                ã•ã‚‰ã«é™ã‚Šã‚‹ã€‚<br>
                ã€2Fã€
                </p>
                <p>
                ã€Œâ€¦â€¦ãˆï¼Ÿã€<br>
                è¦‹é–“é•ã„ã‹ï¼Ÿ ç§ã¯ã•ã‚‰ã«éšæ®µã‚’é™ã‚ŠãŸã€‚<br>
                ãã“ã«ã‚ã‚‹è¡¨ç¤ºã¯ã€ã¾ãŸã—ã¦ã‚‚<span class="highlight">ã€2Fã€</span>ã ã£ãŸã€‚
                </p>
                <p>
                ã€Œãªã‚“ã§ã ã‚ˆï¼ï¼Ÿã€<br>
                ãƒ‘ãƒ‹ãƒƒã‚¯ã«ãªã‚ŠãªãŒã‚‰é™ã‚Šç¶šã‘ã‚‹ã€‚ã€2Fã€ã€2Fã€ã€2Fã€â€¦â€¦ã€‚<br>
                é ­ä¸Šã‹ã‚‰ã€ã‚ºãƒ«ã‚ºãƒ«â€¦â€¦ã¨ã„ã†ä½•ã‹ã‚’å¼•ããšã‚‹éŸ³ãŒè¿«ã£ã¦ãã‚‹ã€‚<br>
                ç§ã®è¶³ãŒã‚‚ã¤ã‚Œã€ç„¡æ§˜ã«è»¢ãŒã‚Šè½ã¡ãŸå…ˆã«ã¯ã€ç¾å’²ãŒç«‹ã£ã¦ã„ãŸã€‚
                </p>
            `,
            choices: [
                { text: "æ„è­˜ãŒæš—è»¢ã™ã‚‹", next: "forced_pact" }
            ]
        },

        // --- å¼·åˆ¶å¥‘ç´„ ---
        forced_pact: {
            icon: "â›“ï¸",
            bg: "bg_stairs_loop",
            cg: "cg_misaki_ghost_dead", // â˜…CGï¼šé¦–ã®æŠ˜ã‚ŒãŸç¾å’²
            music: "bgm_abyss",
            text: `
                <p>
                ã€Œã²ã€ã²ãƒãƒãƒï¼ï¼ ã”ã‚ã‚“ãªã•ã„ï¼ è¨±ã—ã¦ï¼ï¼ã€<br>
                ç§ã¯åºŠã«é€™ã„ã¤ãã°ã£ã¦å‘½ä¹ã„ã‚’ã—ãŸã€‚<br>
                ç¾å’²ã®éœŠãŒã€æŠ˜ã‚Œæ›²ãŒã£ãŸè…•ã‚’ä¼¸ã°ã—ã€ç§ã®é¡”ã‚’é·²æ´ã¿ã«ã™ã‚‹ã€‚<br>
                ä¸‡åŠ›ã®ã‚ˆã†ãªåŠ›ã ã€‚é¡ã®éª¨ãŒè»‹ã‚€ã€‚
                </p>
                <p class="ghost-voice">
                ã€è¨±ã‚µãƒŠã‚¤ã€‚çµ¶å¯¾ãƒ‹ã€‚ã€<br>
                ã€ãƒ‡ãƒ¢ã€ãƒãƒ£ãƒ³ã‚¹ãƒ²ã‚¢ã‚²ãƒ«ã€‚ã€<br>
                ã€ç§ãƒä»£ãƒ¯ãƒªãƒ‹ã€ã‚¢ã‚¤ãƒ„ãƒ©ãƒ²æ®ºã‚·ãƒ†ã€‚ã€
                </p>
                <p>
                ã€Œã“ã€æ®ºã™â€¦â€¦ï¼Ÿã€<br>
                ã€Œãã†ã€‚çŠ¬é£¼ã¨æ¨©ç”°ã€‚ã‚ã„ã¤ã‚‰ã‚’åœ°ç„ã«é€ã‚Œã°ã€ã‚ã‚“ãŸã¯è¦‹é€ƒã—ã¦ã‚ã’ã‚‹ã€
                </p>
                <p>
                é¸æŠè‚¢ãªã©ãªã‹ã£ãŸã€‚<br>
                ã“ã®å ´ã§å‘ªã„æ®ºã•ã‚Œã‚‹ã‹ã€ãã‚Œã¨ã‚‚æ®ºäººé¬¼ã®æ‰‹å…ˆã¨ãªã‚‹ã‹ã€‚<br>
                ç§ã®ç”Ÿå­˜æœ¬èƒ½ãŒå«ã¶ã€‚<br>
                ã—ã‹ã—ã€ç†æ€§ãŒãã‚Œã‚’æ‹’çµ¶ã™ã‚‹ã€‚äººæ®ºã—ãªã‚“ã¦ã§ãã‚‹ã‚ã‘ãŒãªã„ã€‚
                </p>
            `,
            choices: [
                { text: "ã€Œã‚„ã‚Šã¾ã™ï¼ ã‚„ã‚Šã¾ã™ã‹ã‚‰åŠ©ã‘ã¦ï¼ï¼ã€", next: "monday_murder_1" },
                { text: "ã€Œç„¡ç†ã§ã™â€¦â€¦æ®ºã›ãªã„ï¼ã€ã¨æ‹’çµ¶ã™ã‚‹", next: "refuse_pact", class: "btn-refuse" }
            ]
        },

        // ============================================================
        // BAD END ROUTE: æ‹’çµ¶ï¼ˆè™æ®ºã¸ã®åºç« ï¼‰
        // ============================================================
        refuse_pact: {
            icon: "ğŸš«",
            bg: "bg_stairs_loop",
            cg: "cg_misaki_ghost_dead",
            text: `
                <p>
                ã€Œã‚€ã€ç„¡ç†ã â€¦â€¦ãã‚“ãªã“ã¨ã§ããªã„ï¼ã€<br>
                ã€Œäººæ®ºã—ãªã‚“ã¦â€¦â€¦åƒ•ã¯â€¦â€¦ã†ã‚ã‚ã‚ã‚ï¼ã€
                </p>
                <p>
                ç§ã¯ææ€–ã®ã‚ã¾ã‚ŠéŒ¯ä¹±ã—ã€ç¾å’²ã®æ‰‹ã‚’æŒ¯ã‚Šæ‰•ãŠã†ã¨æš´ã‚ŒãŸã€‚<br>
                å½¼å¥³ã®ææ¡ˆã¯ç‹‚ã£ã¦ã„ã‚‹ã€‚<br>
                ã“ã“ã§æ®ºã•ã‚Œã‚‹æ–¹ãŒãƒã‚·ã â€¦â€¦ã„ã‚„ã€æ­»ã«ãŸããªã„ï¼<br>
                çŸ›ç›¾ã—ãŸæ€è€ƒãŒè„³å†…ã‚’é§†ã‘å·¡ã‚Šã€ç§ã¯ãŸã ã®å­ä¾›ã®ã‚ˆã†ã«æ³£ãå«ã‚“ã ã€‚
                </p>
                <p class="ghost-voice">
                ã€â€¦â€¦ã‚½ã‚¦ã€‚ã€<br>
                ã€å½¹ãƒ‹ç«‹ã‚¿ãƒŠã‚¤ãƒŠãƒ©ã€ã‚¤ãƒ©ãƒŠã‚¤ã€‚ã€
                </p>
                <p>
                ç¾å’²ã®å£°ã‹ã‚‰ã€ä¸€åˆ‡ã®æ„Ÿæƒ…ãŒæ¶ˆãˆãŸã€‚<br>
                é¡”ã‚’æ´ã‚“ã§ã„ãŸæ‰‹ã®åŠ›ãŒã€é™ç•Œã‚’è¶…ãˆã¦å¼·ã¾ã‚‹ã€‚<br>
                ãƒŸã‚·ãƒŸã‚·ã¨é ­è“‹éª¨ãŒè»‹ã‚€éŸ³ãŒã€è„³å†…ã«ç›´æ¥éŸ¿ã„ãŸã€‚
                </p>
            `,
            choices: [
                { text: "ã€Œç—›ã„ã€ã‚„ã‚ã¦ãã‚Œï¼ã€", next: "torture_phase_1" }
            ]
        },

        // --- è¿½åŠ ã‚·ãƒ¼ãƒ³1: ä¾µé£Ÿ ---
        torture_phase_1: {
            icon: "ğŸ§Ÿ",
            bg: "bg_stairs_loop",
            sound: "se_glitch", // â˜…SEï¼šãƒã‚°éŸ³
            text: `
                <p>
                ã€Œã‚ãŒã£â€¦â€¦ï¼ ã„ã ã€ç—›ã„ãƒƒï¼ï¼ã€
                </p>
                <p>
                é¦–ã‚’ç· ã‚ä¸Šã’ã‚‹æŒ‡ãŒã€çš®è†šã‚’çªãç ´ã£ã¦è‚‰ã«é£Ÿã„è¾¼ã‚“ã§ãã‚‹ã€‚<br>
                æ¿€ç—›ã€‚<br>
                ã¾ã‚‹ã§ç†±ã—ãŸé‰„ã”ã¦ã‚’æŠ¼ã—å½“ã¦ã‚‰ã‚ŒãŸã‚ˆã†ãªã€ç„¼ã‘ã‚‹ç—›ã¿ã ã€‚
                </p>
                <p>
                ã€ŒåŠ©ã‘â€¦â€¦ã¦â€¦â€¦ã€
                </p>
                <p>
                å£°ãŒå‡ºãªã„ã€‚<br>
                è¦–ç•Œã®ç«¯ã‹ã‚‰ã€é»’ã„ã€Œã‚·ãƒŸã€ã®ã‚ˆã†ãªã‚‚ã®ãŒåºƒãŒã‚Šã€éå¸¸éšæ®µã®ç„¡æ©Ÿè³ªãªã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã‚’ä¾µé£Ÿã—ã¦ã„ãã€‚<br>
                ãã®ã‚·ãƒŸã®ä¸­ã‹ã‚‰ã€ç„¡æ•°ã®ç™½ã„æ‰‹ãŒä¼¸ã³ã¦ããŸã€‚
                </p>
                <p class="ghost-voice">
                ã€ã‚ªã‚¤ãƒ‡ã€‚ã‚³ãƒƒãƒãƒå¯’ã‚¤ãƒ¨ã€‚ã€<br>
                ã€æ—©ã‚¯ã€æ—©ã‚¯â€¦â€¦ã€
                </p>
                <p>
                äº¡è€…ãŸã¡ã®æ‰‹è¶³ãŒã€ç§ã®è¶³é¦–ã‚’ã€æ‰‹é¦–ã‚’æ´ã‚€ã€‚<br>
                ãšã‚‹ãšã‚‹ã¨å¼•ããšã‚Šè¾¼ã¾ã‚Œã‚‹ã€‚<br>
                ã‚ã®ä¸–ã¸ã®å…¥ã‚Šå£ã¸ã€‚
                </p>
            `,
            choices: [
                { text: "å¿…æ­»ã«æŠµæŠ—ã™ã‚‹", next: "torture_phase_2" }
            ]
        },

        // --- è¿½åŠ ã‚·ãƒ¼ãƒ³2: çµ¶æœ›ã®å®£å‘Š ---
        torture_phase_2: {
            icon: "ğŸ‘ï¸",
            bg: "bg_stairs_loop",
            sound: "se_impact", // â˜…SEï¼šè¡æ’ƒéŸ³
            text: `
                <p>
                ã€Œã„ã‚„ã ï¼ æ­»ã«ãŸããªã„ï¼ ã¾ã æ­»ã«ãŸããªã„ï¼ï¼ã€
                </p>
                <p>
                ç§ã¯æ¶™ã¨é¼»æ°´ã‚’å‚ã‚Œæµã—ã€è¦‹è‹¦ã—ãæŠµæŠ—ã—ãŸã€‚<br>
                çˆªãŒå‰¥ãŒã‚Œã‚‹ã»ã©åºŠã‚’æ»ãã‚€ã—ã‚Šã€ç”Ÿã«ã—ãŒã¿ã¤ãã€‚<br>
                ã—ã‹ã—ã€ç¾å’²ã®å†·ã‚„ã‚„ã‹ãªç³ã¯ã€æ±šç‰©ã‚’è¦‹ã‚‹ã‚ˆã†ãªç›®ã¤ãã§ç§ã‚’è¦‹ä¸‹ã‚ã—ã¦ã„ã‚‹ã€‚
                </p>
                <p class="ghost-voice">
                ã€ãƒãƒ£ãƒ³ã‚¹ãƒä¸Šã‚²ã‚¿ã€‚ãƒ‡ãƒ¢ã€ã‚¢ãƒ³ã‚¿ãƒé€ƒã‚²ã‚¿ã€‚ã€<br>
                ã€è²¬ä»»ãƒ²å–ãƒ©ãƒŠã‚¤äººé–“ãƒ‹ã€ç”Ÿã‚­ãƒ«è³‡æ ¼ãƒŠãƒ³ãƒ†ãƒŠã‚¤ã€‚ã€
                </p>
                <p>
                å½¼å¥³ã®é¡”ãŒã€ã‚ã‚Šãˆãªã„è§’åº¦ã§å‚¾ã„ãŸã€‚<br>
                <span class="highlight">ãƒ¡ãƒªãƒ¡ãƒªâ€¦â€¦ã€‚</span><br>
                å½¼å¥³è‡ªèº«ã®é¦–ãŒæŠ˜ã‚Œã‚‹éŸ³ã€‚
                </p>
                <p>
                ãã—ã¦ã€å½¼å¥³ã¯ç§ã®é¡”ã®ç›®ã®å‰ã¾ã§é¡”ã‚’è¿‘ã¥ã‘ã€è…è‡­ã®ã™ã‚‹å£ã‚’é–‹ã„ãŸã€‚
                </p>
                <p class="ghost-voice">
                ã€åŒã‚¸è‹¦ã‚·ãƒŸãƒ²ã€å‘³ãƒ¯ãƒƒãƒ†ï¼Ÿã€
                </p>
            `,
            choices: [
                { text: "â€¦â€¦ã‚â€¦â€¦", next: "bad_end_fear" },
                { text: "ã€Œã‚„ã‚Šã¾ã™ï¼ æ®ºã—ã¾ã™ã‹ã‚‰åŠ©ã‘ã¦ï¼ï¼ã€", next: "monday_murder_1" }
            ]
        },

        bad_end_fear: {
            icon: "ğŸ’€",
            bg: "bg_stairs_loop",
            sound: "se_slam", // â˜…SEï¼šé¦–æŠ˜ã‚Œ
            music: "bgm_ending",
            effect: "blood",   // â˜…èµ¤ãæŸ“ã‚ã‚‹
            text: `
                <p>
                <span class="scream">ãƒœã‚­ãƒƒã€‚</span>
                </p>
                <p>
                ä¹¾ã„ãŸéŸ³ãŒä½“ã®ä¸­ã§éŸ¿ã„ãŸã€‚<br>
                è¦–ç•ŒãŒãã‚‹ã‚Šã¨å›è»¢ã—ã€è‡ªåˆ†ã®èƒŒä¸­ãŒè¦‹ãˆãŸã€‚<br>
                ã‚ãã€é¦–ãŒå›ã£ãŸã®ã‹ã€‚
                </p>
                <p class="ghost-voice">
                ã€å¥‘ç´„ä¸å±¥è¡Œï¼ˆDefaultï¼‰ã€‚<br>
                å³æ™‚åŸ·è¡Œã‚·ãƒã‚¹ã€‚ã€
                </p>
                <p>
                ç—›ã¿ã‚’æ„Ÿã˜ã‚‹æš‡ã‚‚ãªã‹ã£ãŸã€‚<br>
                ç§ã®æ„è­˜ã¯ã€ç„¡é™ã«ç¶šãéšæ®µã®é—‡ã¸ã¨å¸ã„è¾¼ã¾ã‚Œã¦æ¶ˆãˆãŸã€‚
                </p>
                <div class="ending-card">
                    <div class="end-title">BAD END: å¥‘ç´„ä¸å±¥è¡Œ (Execution)</div>
                    <p>ææ€–ã«å±ˆã—ãŸç”·ã¯ã€ãã®ææ€–ãã®ã‚‚ã®ã«å–ã‚Šæ®ºã•ã‚ŒãŸã€‚</p>
                </div>
            `,
            choices: [
                { text: "ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹", next: "back_to_title" }
            ]
        },

        // ============================================================
        // SURVIVAL ROUTE: æ®ºäººå®Ÿè¡Œ
        // ============================================================
        // --- æ®ºäºº1ï¼šçŠ¬é£¼ï¼ˆã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼ï¼‰ ---
        monday_murder_1: {
            icon: "ğŸ©¸",
            bg: "bg_shredder_room", // â˜…èƒŒæ™¯ï¼šã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼å®¤
            cg: "",                 // CGæ¶ˆã™
            music: "bgm_office",    // â˜…BGMï¼šæ—¥å¸¸ï¼ˆç‹‚æ°—ï¼‰
            text: `
                <span class="name">æœˆæ›œæ—¥ ã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼å®¤</span>
                <p>
                ç¿Œæ—¥ã€‚ç§ã¯ç”ŸããŸå¿ƒåœ°ãŒã—ãªã„ã¾ã¾å‡ºç¤¾ã—ãŸã€‚<br>
                æ˜¨å¤œã®ææ€–ãŒã€é¦–ã«æ®‹ã‚‹å†·ãŸã„æ„Ÿè§¦ãŒã€ç§ã‚’æ”¯é…ã—ã¦ã„ãŸã€‚<br>
                èƒŒå¾Œã«ã¯å¸¸ã«ç¾å’²ã®æ°—é…ãŒã‚ã‚‹ã€‚<br>
                æ—©ãã‚ã„ã¤ã‚‰ã‚’æ®ºã•ãªã„ã¨ã€ä»Šåº¦ã“ãç§ãŒæ®ºã•ã‚Œã‚‹ã€‚
                </p>
                <p>
                ç§ã¯<span class="highlight">çŠ¬é£¼å…ˆè¼©</span>ã‚’ã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼å®¤ã«å‘¼ã³å‡ºã—ãŸã€‚<br>
                ã€Œå…ˆè¼©ã€ç¾å’²ã®ä»¶ã§ãƒ¤ãƒã„ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚<br>
                ã“ã“ã§å‡¦åˆ†ã—ã¾ã—ã‚‡ã†ã€‚æ‰‹ä¼ã„ã¾ã™ã‹ã‚‰ã€
                </p>
                <p>
                ã€Œã¾ã€ãƒã‚¸ã‹ï¼ é ¼ã‚€ã‚ˆï¼ã€<br>
                çŠ¬é£¼ã¯å®‰å µã®è¡¨æƒ…ã§ã€å¤§å‹ã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼ã®å‰ã«ç«‹ã£ãŸã€‚<br>
                ã€Œã“ã‚Œã‹ï¼Ÿ ã“ã‚Œã‚’å…¥ã‚Œã‚Œã°ã„ã„ã®ã‹ï¼Ÿã€<br>
                å½¼ã¯èº«ã‚’ä¹—ã‚Šå‡ºã—ã¦æŠ•å…¥å£ã‚’è¦—ãè¾¼ã‚€ã€‚
                </p>
                <p>
                ã€Œãˆãˆã€‚â€¦â€¦ã•ã‚ˆã†ãªã‚‰ã€
                </p>
                <p>
                ç§ã¯å½¼ã®èƒŒä¸­ã‚’ã€å…¨ä½“é‡ã‚’ã‹ã‘ã¦çªãé£›ã°ã—ãŸã€‚
                </p>
                <p>
                <span class="scream">ã€Œãã‚ƒã‚ã‚ã‚ã‚ã‚ï¼ï¼ã€</span>
                </p>
                <p>
                ãƒã‚¯ã‚¿ã‚¤ã”ã¨é¦–ãŒå·»ãè¾¼ã¾ã‚Œã‚‹ã€‚<br>
                ç§ã¯é£›ã³æ•£ã‚‹è¡€ã‚’æµ´ã³ãªãŒã‚‰ã€éœ‡ãˆãŒæ­¢ã¾ã‚‰ãªã‹ã£ãŸã€‚<br>
                ç½ªæ‚ªæ„Ÿã˜ã‚ƒãªã„ã€‚ã€Œã“ã‚Œã§åŠåˆ†åŠ©ã‹ã£ãŸã€ã¨ã„ã†å®‰å µã§ã€‚
                </p>
            `,
            sound: "se_shredder", // â˜…SEï¼šã‚·ãƒ¥ãƒ¬ãƒƒãƒ€ãƒ¼
            choices: [
                { text: "æ¬¡ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¸å‘ã‹ã†", next: "monday_murder_1_done" }
            ]
        },
        monday_murder_1_done: {
            bg: "cg_shredder_blood", // â˜…èƒŒæ™¯ï¼šè¡€ã¾ã¿ã‚Œ
            sound: "se_execution",
            effect: "blood",
            text: "",
            next: "monday_murder_2",
            choices: [ { text: "æ¬¡ã¸...", next: "monday_murder_2" } ]
        },

        // --- æ®ºäºº2ï¼šæ¨©ç”°ï¼ˆè–¬ã®æ²¡åï¼‰ ---
        monday_murder_2: {
            icon: "ğŸ’Š",
            bg: "bg_meeting_room",  // â˜…èƒŒæ™¯ï¼šä¼šè­°å®¤
            cg: "",
            effect: "normal",       // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æˆ»ã™
            music: "bgm_horror",    // â˜…BGMï¼šææ€–
            text: `
                <span class="name">æœˆæ›œæ—¥ å¤œ ä¼šè­°å®¤</span>
                <p>
                æ¬¡ã¯<span class="highlight">æ¨©ç”°éƒ¨é•·</span>ã ã€‚<br>
                å½¼ã¯é‡ã„å¿ƒè‡“ç—…ã‚’æ‚£ã£ã¦ãŠã‚Šã€å¸¸ã«ãƒ‹ãƒˆãƒ­ï¼ˆè–¬ï¼‰ã‚’æŒã¡æ­©ã„ã¦ã„ã‚‹ã€‚<br>
                ç§ã¯å½¼ã‚’ç„¡äººã®ä¼šè­°å®¤ã«å‘¼ã³å‡ºã—ãŸã€‚
                </p>
                <p>
                ã€Œãªã‚“ã ã€è©±ã¨ã„ã†ã®ã¯ã€<br>
                ã€Œéƒ¨é•·ã€‚ç¾å’²ã•ã‚“ãŒã€ãã“ã«ã„ã¾ã™ã‚ˆã€
                </p>
                <p>
                ç§ãŒæŒ‡å·®ã—ãŸå…ˆã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚¿ãƒ¼ãŒå‹æ‰‹ã«èµ·å‹•ã—ã€ãƒã‚¤ã‚ºæ··ã˜ã‚Šã®ç¾å’²ã®éºå½±ãŒå¤§å†™ã—ã«ãªã£ãŸã€‚<br>
                ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰çµ¶å«ãŒè½Ÿãã€‚<br>
                <span class="ghost-voice">ã€æ®ºã‚·ãƒ†ãƒ¤ãƒ«ï¼ æ®ºã‚·ãƒ†ãƒ¤ãƒ«ï¼ã€</span>
                </p>
                <p>
                ã€Œã†ã€ã†ã‚ãããï¼ï¼Ÿã€<br>
                æ¨©ç”°ã¯ææ€–ã§é¡”ã‚’å¼•ãã¤ã‚‰ã›ã€èƒ¸ã‚’æŠ¼ã•ãˆã¦ã†ãšãã¾ã£ãŸã€‚<br>
                ã€Œãã€è–¬â€¦â€¦è–¬â€¦â€¦ï¼ã€<br>
                å½¼ã¯éœ‡ãˆã‚‹æ‰‹ã§ã€ãƒã‚±ãƒƒãƒˆã‹ã‚‰ãƒ”ãƒ«ã‚±ãƒ¼ã‚¹ã‚’å–ã‚Šå‡ºã—ãŸã€‚
                </p>
                <p>
                ç§ã¯é™ã‹ã«æ­©ã¿å¯„ã‚Šã€å½¼ã®æ‰‹ã‹ã‚‰ãƒ”ãƒ«ã‚±ãƒ¼ã‚¹ã‚’ã‚‚ãå–ã£ãŸã€‚
                </p>
                <p>
                ã€Œã‚â€¦â€¦è¿”ã›â€¦â€¦é ¼ã‚€â€¦â€¦ã€<br>
                ã€Œãƒ€ãƒ¡ã§ã™ã€‚ã“ã‚Œã¯æ²¡åã§ã™ã€
                </p>
                <p>
                ç§ã¯å½¼ã®ç›®ã®å‰ã§ã€ã‚±ãƒ¼ã‚¹ã®ä¸­èº«ã‚’ã‚´ãƒŸç®±ã«ã¶ã¡ã¾ã‘ãŸã€‚<br>
                ã€Œã‚â€¦â€¦ãŒâ€¦â€¦ãƒƒã€<br>
                æ¨©ç”°ã¯çµ¶æœ›ã®è¡¨æƒ…ã§æ‰‹ã‚’ä¼¸ã°ã—ã€ãã—ã¦å‹•ã‹ãªããªã£ãŸã€‚
                </p>
            `,
            sound: "se_heart", // â˜…SEï¼šå¿ƒè‡“ç™ºä½œ
            choices: [
                { text: "å½¼å¥³ã®å¥´éš·ã¨ã—ã¦ã€ç”Ÿã‹ã•ã‚Œã‚‹", next: "to_climax" }
            ]
        }
    };

    // â–¼â–¼â–¼ ã‚¨ãƒ³ã‚¸ãƒ³éƒ¨ â–¼â–¼â–¼
    const dom = {
        text: document.getElementById("narrative-area"),
        choices: document.getElementById("choices-container")
    };

    // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    const savedData = JSON.parse(localStorage.getItem("yojitsu_save")) || { route: "fear", sanity: 100, karma: 0 };

    function render(sceneId) {
        window.scrollTo(0, 0);
        document.getElementById("game-wrapper").scrollTop = 0;

        if(sceneId === "back_to_title") {
            const currentSave = JSON.parse(localStorage.getItem("yojitsu_save")) || {};
            currentSave.cleared_fear = true;
            localStorage.setItem("yojitsu_save", JSON.stringify(currentSave));
            window.location.href = "index.html";
            return;
        }

        if(sceneId === "to_climax") {
            savedData.route = "fear";
            savedData.cleared_fear = true;
            savedData.items = ["ç¾å’²ã®ã‚¹ãƒãƒ›(å‡¶å™¨)"];
            savedData.karma = 100;
            localStorage.setItem("yojitsu_save", JSON.stringify(savedData));
            window.location.href = "climax.html";
            return;
        }
        
        // â˜…ç‰¹æ®Šï¼šæ¼”å‡ºã®ã¿ã®ã‚¹ãƒ†ãƒƒãƒ—
        if(sceneId === "monday_murder_1_done") {
             visuals.setBg("cg_shredder_blood");
             visuals.setFilter("blood");
             audio.playSe("se_execution");
             setTimeout(() => {
                 render("monday_murder_2");
             }, 3000); // 3ç§’å¾Œã«è‡ªå‹•é·ç§»
             return;
        }

        const scene = scenes[sceneId];
        
        // --- 1. ç”»åƒãƒ»éŸ³å£°åˆ¶å¾¡ ---
        if(scene) {
            visuals.setBg(scene.bg);
            visuals.setCg(scene.cg);
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚‚èƒŒæ™¯ç”»åƒã‚’è¨­å®š
            if(scene.bg) {
                document.getElementById("scene-header").style.backgroundImage = `url('images/${scene.bg}.jpg')`;
            }
            
            if(scene.effect === "blood") visuals.setFilter("blood");
            else visuals.setFilter("normal");

            if(scene.music === "stop") audio.stopBgm();
            else if(scene.music) audio.playBgm(scene.music);

            if(scene.sound) audio.playSe(scene.sound);
        }

        // --- 2. ç”»é¢æç”» ---
        dom.text.innerHTML = scene.text;
        
        dom.text.animate([{opacity:0}, {opacity:1}], {duration: 1000, fill:"forwards"});

        dom.choices.innerHTML = "";
        scene.choices.forEach(c => {
            const btn = document.createElement("button");
            btn.innerText = c.text;
            if(c.class) btn.className = c.class;
            btn.onclick = () => render(c.next);
            dom.choices.appendChild(btn);
        });
    }

    render("start");

</script>
</body>
</html>